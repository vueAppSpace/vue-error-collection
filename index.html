<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover" />

    <title>健康新奥-工间操</title>
    <link rel="icon" href="data:image/ico;base64,aWNv" />
    <link
      rel="stylesheet"
      href="https://lk-webfont.oss-accelerate.aliyuncs.com/web/xinao-health/vant/vant.min.2.12.49.css"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script type="text/javascript" src="https://oss-statics.icomecloud.com/jsbridge/1.5.9/x-bridge.umd.js"></script>
    <script src="https://lk-webfont.oss-accelerate.aliyuncs.com/web/xinao-health/jssdk/dayjs.min.1.8.21.js"></script>

    <script>
      //image 对象可以跨域发送get请求(并且它不需要被添加到DOM上就能发送请求)
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = "https://wq.360buyimg.com/js/common/dest/wq.jshop.report.min.js";

      //使用 post 请求发送埋点数据
      document.addEventListener("visibilitychange", function logData() {
        if (document.visibilityState === "hidden") {
          navigator.sendBeacon("/log", { name: "wc" });
        }
      });
      //err-collection ===>
      /*
        只能收集纯 js 错误

        可以捕获的错误类型:
        1.运行时错误
        2.异步错误
        
        不可捕获的错误类型:
        1.语法错误
        2.promise错误
      */
      function updateErrorCount() {
        let errorCount = JSON.parse(sessionStorage.getItem("errorCount"));
        if (!errorCount) {
          errorCount = 1;
        }
        errorCount++;
        sessionStorage.setItem("errorCount", errorCount);
        console.log("errorCount", errorCount);
      }

      //捕获的方式一：
      //全局捕获js错误
      window.onerror = function (message, source, lineno, colno, error) {
        const empNo = localStorage.getItem("empNo");
        console.log("当前员工", empNo);

        const errObj = { message, source, lineno, colno, error };
        console.log("[window.onerror]: 捕获到的异常,", errObj);

        //记录捕获的错误的次数
        updateErrorCount();
      };

      //捕获的方式二：
      //用于捕获: 图片，script，css等资源文件加载错误
      window.addEventListener(
        "error",
        error => {
          console.log("[window.addEventListener error]: 捕获到的异常,", error);
        },
        true
      );

      //捕获的方式三：
      //全局捕获 promise错误
      window.addEventListener("unhandledrejection", error => {
        console.log("[window.addEventListener unhandledrejection]: 捕获到的promise异常,", error);
      });
    </script>
  </head>

  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
